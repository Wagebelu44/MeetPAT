$(document).ready(function(){document.querySelector("#audience_name").setCustomValidity("invalid");var e=function(){var e=document.querySelector('input[type="file"]').checkValidity(),i=document.querySelector("#audience_name").checkValidity();e&&i?$("#submit_audience").prop("disabled",!1):$("#submit_audience").prop("disabled",!0)},i=window.location.protocol+"//"+window.location.host;FilePond.registerPlugin(FilePondPluginFileValidateType);var t=FilePond.create(document.querySelector('input[type="file"]'));document.querySelector(".filepond--root").addEventListener("FilePond:removefile",i=>{$.post("/api/meetpat-client/large-data/delete?file_id="+$("#fileId").val()+"&user_id="+$("#userId").val(),function(e){}).done(function(i){e()}).fail(function(e){})}),FilePond.setOptions({maxFileSize:"200MB",required:!0,server:{url:i,process:{url:"/api/meetpat-client/large-data/upload?user_id="+$("#userId").val(),method:"POST",withCredentials:!1,headers:{},onerror:function(e){console.log(e),$("#submit_audience").prop("disabled",!0)},onload:function(i){i=JSON.parse(i),"csv"!=t.getFile().fileExtension?($("#no-file").show(),t.removeFile()):$("#no-file").hide(),"500"!=i.status?$("#fileId").val(i.file_id):(t.removeFile(),$("#no-file").show(),i.error&&$("#no-file").html(i.error)),e()}}}}),$("form#upload-custom-audience").submit(function(e){e.preventDefault();var i=new FormData(this);$("#submit_audience").prop("disabled",!0),$("#submit_audience").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n                    Submitting...'),$("#fieldsetId").prop("disabled",!0),$.ajax({url:"/api/meetpat-client/large-data/handler",type:"POST",data:i,success:function(e){$("#submit_audience").html("Done"),$("#alert-section").empty(),$("#alert-section").append('<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Success!</strong> Clients have been uploaded successfully.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div>')},complete:function(e){$("#loader").css("display","none"),window.location="/meetpat-client/data-visualisation"},error:function(e){$("#submit_audience").prop("disabled",!1),$("#submit_audience").html("Submit"),$("#alert-section").empty(),$("#alert-section").append('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Error!</strong> Clients failed to upload.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div>'),$("#fieldsetId").prop("disabled",!1)},cache:!1,contentType:!1,processData:!1})}),$("#audience_name").on("change keyup select",function(){$(this).val().match(/^[a-zA-Z ]{2,}$/)?($(this).addClass("is-valid"),$(this).removeClass("is-invalid"),this.setCustomValidity("")):($(this).removeClass("is-valid"),$(this).addClass("is-invalid"),this.setCustomValidity("invalid")),e()})});