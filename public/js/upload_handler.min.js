var displayLoader=function(){$("#loader").css("display","block")},site_url=window.location.protocol+"//"+window.location.host,run_job=function(e){"facebook"==e.platform?($("#facebook_upload_status").html('<div class="spinner-block"><div class="spinner spinner-3"></div></div>'),$.post("/api/meetpat-client/upload-custom-audience/facebook",e,function(e){console.log(e)}).done(function(e){$("#facebook_upload_status").html('<i class="fas fa-check-circle"></i>')}).fail(function(e){console.log(e),$("#facebook_upload_status").html('<i class="fas fa-exclamation-circle" style="color: red;"></i>'),$("#alert-section").append('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Error!</strong> There was an error syncing the audience file with facebook. <a href="/contact">Contact MeetPAT</a> for assistance.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>')})):($("#google_upload_status").html('<div class="spinner-block"><div class="spinner spinner-3"></div></div>'),$.post("/api/meetpat-client/upload-custom-audience/google",e,function(e){console.log(e)}).done(function(e){$("#google_upload_status").html('<i class="fas fa-check-circle"></i>')}).fail(function(e){console.log(e),$("#google_upload_status").html('<i class="fas fa-exclamation-circle" style="color: red;"></i>'),$("#alert-section").append('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Error!</strong> There was an error syncing the audience file with Google. <a href="/contact">Contact MeetPAT</a> for assistance.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div>')}))};FilePond.registerPlugin(FilePondPluginFileValidateType);var pond=FilePond.create(document.querySelector('input[type="file"]'));const pond_element=document.querySelector(".filepond--root");pond_element.addEventListener("FilePond:removefile",e=>{$.post("/api/delete-file?file_id="+$("#fileId").val()+"&user_id="+$("#userId").val(),function(e){}).done(function(e){$("#submit_audience").prop("disabled",!0)}).fail(function(e){})}),FilePond.setOptions({maxFileSize:"200MB",required:!0,server:{url:site_url,process:{url:"/api/upload-file?user_id="+$("#userId").val(),method:"POST",withCredentials:!1,headers:{},onerror:function(e){console.log(e),$("#submit_audience").prop("disabled",!0)},onload:function(e){e=JSON.parse(e),"csv"!=pond.getFile().fileExtension?($("#no-file").show(),pond.removeFile()):$("#no-file").hide(),"500"!=e.status?($("#fileId").val(e.file_id),$("#submit_audience").prop("disabled",!1)):(pond.removeFile(),$("#no-file").show(),e.error&&$("#no-file").html(e.error))}}}}),$("form#upload-custom-audience").submit(function(e){e.preventDefault();var o=new FormData(this);$.ajax({url:"/api/meetpat-client/upload-custom-audience",type:"POST",data:o,success:function(e){e.errors?($("#alert-section").empty(),$("#alert-section").append('<div class="alert alert-danger alert-dismissible fade show" role="alert"><strong>Error!</strong> Please make sure that all fields are valid<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div>'),e.errors.audience_name&&($("#audience_name").addClass("is-invalid"),$("#invalid-audience-name").empty(),$("#invalid-audience-name").append(e.errors.audience_name)),e.errors.audience_file&&($("#no-file").css("display","block"),$(".upload-box").css("border-color","#e3342f"),$("#invalid-file").empty(),$("#invalid-file").append(e.errors.audience_file))):$("#upload-custom-audience").css("display","none")},complete:function(e){if(console.log(e.responseJSON),$("#loader").css("display","none"),$("#alert-section").empty(),e.responseJSON.length>0?($("#alert-section").append('<div class="alert alert-success alert-dismissible fade show" role="alert"><strong>Success!</strong> Your file has been uploaded the sync is now in progress.<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div>'),$("#card-title").html("Sync In Progress"),$("#progress-sync").html('<table class="table"><tbody id="sync-table-body"></tbody></table>'),2==e.responseJSON.length?($("#sync-table-body").append('<tr id="facebook_upload"><td>Facebook</td><td id="facebook_upload_status">pending...</td></tr>'),$("#sync-table-body").append('<tr id="google_upload"><td>Google</td><td id="google_upload_status">pending...</td></tr>')):"facebook"==e.responseJSON[0].platform?$("#sync-table-body").append('<tr id="facebook_upload"><td>Facebook</td><td id="facebook_upload_status">pending...</td></tr>'):$("#sync-table-body").append('<tr id="google_upload"><td>Google</td><td id="google_upload_status">pending...</td></tr>')):null!=e.responseJSON.errors?console.log(e.responseJSON.errors):($(".card-body").append('<a href="/meetpat-client" class="btn btn-primary btn-lg btn-block">Back to Dashboard</a>'),$("#alert-section").empty()),2==e.responseJSON.length){o=function(){run_job(e.responseJSON[1])},run_job(e.responseJSON[0]),o(),null==e.errors&&$(document).ajaxStop(function(){$(".card-body").append('<a href="/meetpat-client" class="btn btn-primary btn-lg btn-block">Back to Dashboard</a>'),$("#alert-section").empty()})}else 1==e.responseJSON.length?(run_job(e.responseJSON[0]),null==e.errors&&$(document).ajaxStop(function(){$(".card-body").append('<a href="/meetpat-client" class="btn btn-primary btn-lg btn-block">Back to Dashboard</a>'),$("#alert-section").empty()})):console.log("No Jobs in que.");var o},error:function(e){},cache:!1,contentType:!1,processData:!1}),$("#audience_name").change(function(){""!==$(this).val()?$(this).removeClass("is-invalid"):$(this).hasClass("is-invalid")||$(this).addClass("is-invalid")})}),$(function(){$("#customer-email").popover({html:!0,placement:"top",trigger:"click",toggle:"popover",title:"Email Address",content:"<ul><b>Examples:</b><li>Emily@example.com</li><li>John@example.com</li><li>Helena@example.com</li></ul>"}),$("#customer-phone").popover({html:!0,placement:"top",trigger:"click",toggle:"popover",title:"Phone number",content:"<ul><b>Examples:</b><li>+27123456789</li><li>+27604235555</li><li>+27826456678</li></ul>"})});