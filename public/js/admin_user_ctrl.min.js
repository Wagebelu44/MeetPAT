var get_percentage=function(e,a){return $percentage=a/e*100,Math.trunc($percentage)};function checkForm(e){e.addEventListener("onsubmit",function(e){e?console.log(e):console.log("form submited")})}function validateEmail(e){var a=$(e),s=a.val(),t=a[0].dataset.user;if(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(s).toLowerCase())){a.removeClass("is-invalid"),a.addClass("is-valid"),a[0].setCustomValidity(""),$("#save_changes_uid_"+t).prop("disabled",!1);const e=new XMLHttpRequest,n="/api/meetpat-admin/users/unique-email";e.overrideMimeType("application/json");var i="email="+s+"&user_id="+t;e.open("POST",n,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(i),e.onload=function(){var s=JSON.parse(e.responseText);"true"==s.email_used?($(".modal-mesage-container_email_taken_"+t).css("display","block"),a.removeClass("is-valid"),a.addClass("is-invalid"),$("#save_changes_uid_"+t).prop("disabled",!0)):($(".modal-mesage-container_email_taken_"+t).css("display","none"),a.removeClass("is-invalid"),a.addClass("is-valid"),$("#save_changes_uid_"+t).prop("disabled",!1)),console.log(s)}}else a.addClass("is-invalid"),a[0].setCustomValidity("email is invalid"),$("#save_changes_uid_"+t).prop("disabled",!0)}function validatePassword(e){var a=$(e),s=a.val(),t=a[0].dataset.user;a.removeClass("is-valid"),a.removeClass("is-invalid"),/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/.test(String(s))||""==s?(a.removeClass("is-invalid"),a.addClass("is-valid"),a[0].setCustomValidity(""),$("#save_changes_uid_"+t).prop("disabled",!1)):(a.addClass("is-invalid"),a.removeClass("is-valid"),a[0].setCustomValidity("Password is invalid"),$("#save_changes_uid_"+t).prop("disabled",!0))}function validateRequired(e){var a=$(e),s=e.dataset.user;0===a.val().length?(a.addClass("is-invalid"),a.removeClass("is-valid"),a[0].setCustomValidity("field is required"),$("#save_changes_uid_"+s).prop("disabled",!0)):(a.removeClass("is-invalid"),a.addClass("is-valid"),a[0].setCustomValidity(""),$("#save_changes_uid_"+s).prop("disabled",!1))}function generatedPassword(e){var a=$("#PasswordInput_"+e),s=a[0].dataset.user;a.removeClass("is-invalid"),a.addClass("is-valid"),a[0].setCustomValidity(""),$("#save_changes_uid_"+s).prop("disabled",!1)}function change_status(e){$("#loader").css("display","block"),$(".message-container").empty();const a=new XMLHttpRequest;a.overrideMimeType("application/json");var s="user_id="+e.dataset.user;a.open("POST","/api/meetpat-admin/users/active-status-change",!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(s),a.onload=function(){var s=JSON.parse(a.responseText);"client"==s.user_type?($("i",e).removeClass(),0==s.user_was_active?$("i",e).addClass("fas fa-toggle-on"):$("i",e).addClass("fas fa-toggle-off"),$(".message-container").prepend('<div id="AlertBoxTemp" class="alert alert-success alert-dismissible fade show" role="alert">\n                                <strong>Success!</strong> The active status of the selected user has been changed\n                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>')):$(".message-container").prepend('<div id="AlertBoxTemp" class="alert alert-danger alert-dismissible fade show" role="alert">\n                                <strong>Error!</strong> There is an issue with changing the status of the selected users. Please contact support.\n                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>')},a.onreadystatechange=function(){4===a.readyState&&(console.log("request complete"),$("#loader").css("display","none"))}}function saveChanges(e){$("#loader").css("display","block"),$(".message-container").empty();const a=new XMLHttpRequest;a.overrideMimeType("application/json");var s,t=$("input[name='user_id'] ",e).val(),i=$("input[name='user_name'] ",e).val(),n=$("input[name='user_email'] ",e).val(),l=$("input[name='new_password'] ",e).val(),d=$("input[name='send_mail'] ",e).is(":checked"),o="user_id="+t+"&user_name="+i+"&user_email="+n+"&new_password="+l+"&send_mail="+d;a.open("POST","/api/meetpat-admin/users/edit",!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=function(){"true"==(s=JSON.parse(a.responseText)).email_valid&&"true"==s.user_name_valid?("true"==s.password_change&&"false"==s.password_valid?($("input[name='new_password'] ",e).addClass("is-invalid"),$(".modal-mesage-container_"+s.users_id).css("display","block")):$("#EditUser_"+t).modal("hide"),"true"==s.sent_mail?$(".message-container").prepend('<div id="AlertBoxTemp" class="alert alert-success alert-dismissible fade show" role="alert">\n                                                <strong>Success!</strong> Changes to the selected user has been saved and an email has been sent.\n                                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                                <span aria-hidden="true">&times;</span>\n                                                </button>\n                                                </div>'):$(".message-container").prepend('<div id="AlertBoxTemp" class="alert alert-success alert-dismissible fade show" role="alert">\n                                                <strong>Success!</strong> Changes to the selected user has been saved.\n                                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                                <span aria-hidden="true">&times;</span>\n                                                </button>\n                                                </div>')):$(".modal-mesage-container_"+s.users_id).css("display","block"),console.log(s)},a.onreadystatechange=function(){4===a.readyState&&(console.log("request complete"),$("#loader").css("display","none"))},a.send(o)}function deleteUser(e){$("#loader").css("display","block");var a=e.dataset.user;const s=new XMLHttpRequest;s.overrideMimeType("application/json"),s.open("POST","/api/meetpat-admin/users/delete",!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),params="user_id="+a,s.send(params),s.onload=function(){var e=JSON.parse(s.responseText);$("#DeleteUser__"+a).modal("hide"),$(".message-container").empty(),1==e.deleted?$(".message-container").prepend('<div id="AlertBoxTemp" class="alert alert-success alert-dismissible fade show" role="alert">\n                                                <strong>Success!</strong> The selected user has been deleted.\n                                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                                <span aria-hidden="true">&times;</span>\n                                                </button>\n                                                </div>'):$(".message-container").prepend('<div id="AlertBoxTemp" class="alert alert-danger alert-dismissible fade show" role="alert">\n                                                <strong>Error!</strong> The selected user could not be deleted.\n                                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                                <span aria-hidden="true">&times;</span>\n                                                </button>\n                                                </div>')},s.onreadystatechange=function(){4===s.readyState&&(console.log("request complete"),location.reload(!0))}}function viewPassword(e){var a=e.dataset.user,s=$("#PasswordInput_"+a),t=$("i","#ViewPassword_"+a);"password"==s.attr("type")?(s.attr({type:"text"}),t.removeClass(),t.addClass("fas fa-eye-slash")):(s.attr({type:"password"}),t.removeClass(),t.addClass("fas fa-eye"))}function generatePassword(e){var a=e.dataset.user;const s=new XMLHttpRequest;s.overrideMimeType("application/json"),s.open("GET","/api/meetpat-admin/generate-password",!0),s.send(),s.onload=function(){var e=JSON.parse(s.responseText);$("#PasswordInput_"+a).val(e.password),$("#PasswordInput_"+a).removeClass("is-invalid"),$("#PasswordInput_"+a).removeClass("is-valid"),$("#PasswordInput_"+a).addClass("is-valid"),$("#save_changes_uid_"+a).prop("disabled",!1)}}$(document).ready(function(){$.get("/api/meetpat-admin/users",function(){}).done(function(e){e.forEach(function(e){e.audience_files="/meetpat-admin/users/files/"+e.id,e.edit=e.id,e.active={active:e.client.active,user_id:e.id},e.delete=e.id,e.settings=e.id,e.client_uploads?e.uploads={user_id:e.id,uploads_percentage:get_percentage(e.client_uploads.upload_limit,e.client_uploads.uploads),client_upload_limit:e.client_uploads.upload_limit,client_uploads:e.client_uploads.uploads}:e.uploads={user_id:e.id,uploads_percentage:0,client_upload_limit:0,client_uploads:0},$("#clearUploads__"+e.id).click(function(a){$("#clearUploads__"+e.id+" i").addClass("fa-spin"),$.post("/api/meetpat-admin/settings/clear-uploads",{user_id:e.id},function(e){console.log(e)}).fail(function(e){console.log(e)}).done(function(a){"cleared"==a.message?($("#alertSectionSettings__"+e.id).html('<div class="alert alert-success alert-dismissible fade show" role="alert">\n                                <strong>Success</strong>  &mdash; User uploads have been cleared.\n                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>'),$("#userUploadsPercentage__"+e.id).html("0%"),$("#userUploadsPercentage__"+e.id).attr("aria-valuenow",0),$("#userUploadsPercentage__"+e.id).removeAttr("style").css("width","0%")):$("#alertSectionSettings__"+e.id).html('<div class="alert alert-danger alert-dismissible fade show" role="alert">\n                                <strong>Error!</strong>  &mdash; An error has occured please contact support.\n                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>'),$("#clearUploads__"+e.id+" i").removeClass("fa-spin")})}),$("#rmvUsrFrmAffRecs__"+e.id).click(function(){$("#rmvUsrFrmAffRecs__"+e.id+" i").addClass("eraser"),$("#rmvUsrFrmAffRecs__"+e.id).prop("disabled",!0),$.post("/api/meetpat-admin/settings/remove-affiliate",{user_id:e.id},function(e){console.log(e)}).fail(function(a){$("#rmvUsrFrmAffRecs__"+e.id+" i").removeClass("eraser"),$("#rmvUsrFrmAffRecs__"+e.id).prop("disabled",!1),console.log(a)}).done(function(a){"success"==a.message?$("#alertSectionSettings__"+e.id).html('<div class="alert alert-success alert-dismissible fade show" role="alert">\n                                <strong>Success</strong>  &mdash; User has been removed from affiliated records.\n                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>'):$("#alertSectionSettings__"+e.id).html('<div class="alert alert-danger alert-dismissible fade show" role="alert">\n                                <strong>Error!</strong>  &mdash; An error has occured please contact support.\n                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>'),$("#rmvUsrFrmAffRecs__"+e.id+" i").removeClass("eraser"),$("#rmvUsrFrmAffRecs__"+e.id).prop("disabled",!1)})}),$("#updateClientUploadLimit__"+e.id).click(function(){var a=this;$(this).prop("disabled",!0),$(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n                       Saving...'),$("#newUploadLimit__"+e.id).val()>=e.client_uploads.uploads?($("#newUploadLimit__"+e.id).removeClass("is-invalid"),$.post("/api/meetpat-admin/settings/updated-upload-limit",{user_id:e.id,new_upload_limit:$("#newUploadLimit__"+e.id).val()},function(e){console.log(e)}).fail(function(s){console.log(s),$(a).prop("disabled",!1),$(a).html("Save"),$("#alertSectionSettings__"+e.id).html('<div class="alert alert-danger alert-dismissible fade show" role="alert">\n                                <strong>Error!</strong>  &mdash; An error has occured please contact support.\n                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>')}).done(function(s){$(a).prop("disabled",!1),$(a).html("Save"),"success"==s.status?($("#alertSectionSettings__"+e.id).html('<div class="alert alert-success alert-dismissible fade show" role="alert">\n                                    <strong>Success!</strong>  &mdash; User upload limit has been updated.\n                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                    <span aria-hidden="true">&times;</span>\n                                    </button>\n                                </div>'),$("#userUploadsPercentage__"+e.id).html(e.uploads.client_uploads+"/"+$("#newUploadLimit__"+e.id).val()),$("#userUploadsPercentage__"+e.id).attr("aria-valuenow",get_percentage($("#newUploadLimit__"+e.id).val(),e.uploads.client_uploads)),$("#userUploadsPercentage__"+e.id).removeAttr("style").css("width",get_percentage($("#newUploadLimit__"+e.id).val(),e.uploads.client_uploads)+"%")):$("#alertSectionSettings__"+e.id).html('<div class="alert alert-danger alert-dismissible fade show" role="alert">\n                                    <strong>Error!</strong>  &mdash; An error has occured please contact support.\n                                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                    <span aria-hidden="true">&times;</span>\n                                    </button>\n                                </div>')})):($(a).prop("disabled",!1),$(a).html("Save"),$("#newUploadLimit__"+e.id).addClass("is-invalid"),console.log("Limit needs to be bigger thatn current uploads."))}),$("#updateClientCreditLimit__"+e.id).click(function(){var a=this;$(this).prop("disabled",!0),$(this).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n                       Saving...'),$.post("/api/meetpat-admin/settings/updated-credit-limit",{user_id:e.id,new_credit_limit:$("#newCreditLimit__"+e.id).val()},function(e){console.log(e)}).fail(function(s){$(a).prop("disabled",!1),$(a).html("Save"),$("#alertSectionSettings__"+e.id).html('<div class="alert alert-danger alert-dismissible fade show" role="alert">\n                            <strong>Error!</strong>  &mdash; An error has occured please contact support.\n                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                            <span aria-hidden="true">&times;</span>\n                            </button>\n                        </div>'),console.log(s)}).done(function(s){$(a).prop("disabled",!1),$(a).html("Save"),"success"==s.status?$("#alertSectionSettings__"+e.id).html('<div class="alert alert-success alert-dismissible fade show" role="alert">\n                                <strong>Success!</strong>  &mdash; User credit limit has been updated.\n                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>'):$("#alertSectionSettings__"+e.id).html('<div class="alert alert-danger alert-dismissible fade show" role="alert">\n                                <strong>Error!</strong>  &mdash; An error has occured please contact support.\n                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                                <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>')})})});var a=e;new Tabulator("#users-table",{data:a,layout:"fitDataFill",pagination:"local",paginationSize:12,columns:[{title:"ID",field:"id"},{title:"Name",field:"name"},{title:"Email",field:"email"},{title:"Audience Files",field:"audience_files",align:"center",formatter:function(e,a){e.getValue();return"<a href='"+e.getValue()+"'><i class='fas fa-folder action-link'></i></a>"}},{title:"Edit",field:"edit",formatter:function(e,a){e.getValue();return'<button class="edit-tooltip table_button" data-toggle="modal" data-target="#EditUser_'+e.getValue()+'" data-toggle="tooltip" data-html="true" title="<em>edit</em>"><i class="fas fa-pen-alt action-link"></i></button>'}},{title:"Active",field:"active",formatter:function(e,a){e.getValue();return e.getValue().active?'<button id="ActiveStatusBtn_'+e.getValue().user_id+'" onclick="change_status(this)" type="submit" class="active-tooltip table_button ActiveStatusBtn" data-toggle="tooltip" data-html="true" title="<em>status</em>" data-user="'+e.getValue().user_id+'"><i class="fas fa-toggle-on action-link"></i></button>':'<button id="ActiveStatusBtn_'+e.getValue().user_id+'" onclick="change_status(this)" type="submit" class="active-tooltip table_button ActiveStatusBtn" data-toggle="tooltip" data-html="true" title="<em>status</em>" data-user="'+e.getValue().user_id+'"><i class="fas fa-toggle-off action-link"></i></button>'}},{title:"Delete",field:"delete",formatter:function(e,a){return`<button class="delete-tooltip table_button" data-toggle="modal" data-target="#DeleteUser__${e.getValue()}" data-toggle="tooltip" data-html="true" title="<em>delete</em>">\n                                <i class="far fa-trash-alt action-link"></i>\n                            </button>`}},{title:"Uploads",field:"uploads",formatter:function(e,a){var s=e.getValue();return`<div class="progress">\n                                <div class="progress-bar" id="userUploadsPercentage__${s.user_id}" role="progressbar" style="width: ${s.uploads_percentage}%;" aria-valuenow="${s.uploads_percentage}" aria-valuemin="0" aria-valuemax="100">${s.client_uploads}/${s.client_upload_limit}</div>\n                            </div>`}},{title:"Settings",field:"settings",formatter:function(e,a){return`<button class="settings-tooltip table_button" data-toggle="modal" data-target="#SettingsUser__${e.getValue()}" data-toggle="tooltip" data-html="true" title="settings">\n                                <i class="fas fa-cogs action-link"></i>\n                            </button>`}}]});console.log(a)}).fail(function(e){console.log(e)})});